<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Show - T∆∞ T∆∞·ªüng HCM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #da251d 0%, #c41e1a 100%);
            color: #FFD700;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
            color: #FFD700;
        }

        .star {
            color: #FFD700;
            font-size: 2rem;
            margin: 0 10px;
        }

        /* Role Selection Screen */
        .role-selection {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .role-btn {
            padding: 25px 50px;
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #da251d;
            border: 3px solid #FFD700;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 350px;
            text-transform: uppercase;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        .role-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.5);
        }

        .role-btn:active {
            transform: translateY(0);
        }

        /* Game Screen */
        .game-screen {
            display: none;
        }

        .game-screen.active {
            display: block;
        }

        /* Scoreboard */
        .scoreboard {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            gap: 20px;
        }

        .team-score {
            flex: 1;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 3px solid #FFD700;
        }

        .team-score h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .score {
            font-size: 3rem;
            font-weight: bold;
            color: #FFD700;
        }

        /* Question Grid (Host) */
        .question-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .question-cell {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border: 3px solid #FFD700;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #da251d;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .question-cell:hover:not(.answered) {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.6);
        }

        .question-cell.answered {
            cursor: not-allowed;
        }

        .question-cell.team-a {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            border-color: #ff0000;
            color: #fff;
        }

        .question-cell.team-b {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-color: #FFD700;
            color: #da251d;
        }

        .question-cell.dead {
            background: rgba(100, 100, 100, 0.5);
            border-color: #666;
            color: #999;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Buzzer (Team View) */
        .buzzer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
        }

        .buzzer-btn {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border: 8px solid #FFD700;
            font-size: 2.5rem;
            font-weight: bold;
            color: #da251d;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            text-transform: uppercase;
        }

        .buzzer-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 15px 50px rgba(255, 215, 0, 0.7);
        }

        .buzzer-btn:active:not(:disabled) {
            transform: scale(0.95);
        }

        .buzzer-btn:disabled {
            background: rgba(100, 100, 100, 0.5);
            border-color: #666;
            color: #999;
            cursor: not-allowed;
        }

        .buzzer-status {
            margin-top: 30px;
            font-size: 1.5rem;
            text-align: center;
            min-height: 50px;
        }

        /* Host Controls */
        .host-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .control-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            border: 2px solid #FFD700;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 215, 0, 0.4);
            transform: translateY(-2px);
        }

        .control-btn.danger {
            background: rgba(255, 0, 0, 0.3);
            border-color: #ff6666;
            color: #ff6666;
        }

        .control-btn.danger:hover {
            background: rgba(255, 0, 0, 0.5);
        }

        /* Buzzer Alert (Host View) */
        .buzzer-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0, 0, 0, 0.95);
            padding: 50px;
            border-radius: 20px;
            border: 5px solid #FFD700;
            z-index: 1000;
            text-align: center;
            transition: all 0.3s ease;
        }

        .buzzer-alert.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .buzzer-alert h2 {
            font-size: 3rem;
            color: #FFD700;
            animation: pulse 0.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Score Adjustment */
        .score-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        .score-btn {
            padding: 8px 20px;
            font-size: 1rem;
            font-weight: bold;
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            border: 2px solid #FFD700;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .score-btn:hover {
            background: rgba(255, 215, 0, 0.4);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .role-btn {
                min-width: 280px;
                font-size: 1.2rem;
                padding: 20px 30px;
            }

            .buzzer-btn {
                width: 250px;
                height: 250px;
                font-size: 2rem;
            }

            .question-grid {
                gap: 10px;
            }

            .question-cell {
                font-size: 1.2rem;
            }

            .team-score h2 {
                font-size: 1.5rem;
            }

            .score {
                font-size: 2rem;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Question Modal - Only for Host */
        .question-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        #hostScreen .question-modal.show {
            display: flex;
        }

        .question-content {
            background: linear-gradient(135deg, #da251d 0%, #c41e1a 100%);
            border: 5px solid #FFD700;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .question-header {
            font-size: 1.8rem;
            color: #FFD700;
            margin-bottom: 30px;
            text-align: center;
            font-weight: bold;
        }

        .question-text {
            font-size: 1.4rem;
            color: #FFD700;
            margin-bottom: 30px;
            line-height: 1.6;
            text-align: left;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .answer-btn {
            padding: 20px;
            font-size: 1.2rem;
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            border: 3px solid #FFD700;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .answer-btn:hover {
            background: rgba(255, 215, 0, 0.4);
            transform: translateX(10px);
        }

        .answer-btn.correct {
            background: rgba(0, 255, 0, 0.3);
            border-color: #00ff00;
            color: #00ff00;
        }

        .answer-btn.incorrect {
            background: rgba(255, 0, 0, 0.3);
            border-color: #ff6666;
            color: #ff6666;
        }

        .question-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .back-btn {
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.2);
            color: #FFD700;
            border: 2px solid #FFD700;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Approval Notification */
        .approval-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid #FFD700;
            border-radius: 15px;
            padding: 20px;
            z-index: 3000;
            min-width: 300px;
            display: none;
        }

        .approval-notification.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        .approval-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .approve-btn {
            flex: 1;
            padding: 10px;
            font-size: 1rem;
            font-weight: bold;
            background: rgba(0, 255, 0, 0.3);
            color: #00ff00;
            border: 2px solid #00ff00;
            border-radius: 8px;
            cursor: pointer;
        }

        .reject-btn {
            flex: 1;
            padding: 10px;
            font-size: 1rem;
            font-weight: bold;
            background: rgba(255, 0, 0, 0.3);
            color: #ff6666;
            border: 2px solid #ff6666;
            border-radius: 8px;
            cursor: pointer;
        }

        .timer-display {
            font-size: 3rem;
            color: #FFD700;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
        }

        .timer-display.warning {
            color: #ff6666;
            animation: pulse 0.5s ease-in-out infinite;
        }

        .answer-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .correct-btn {
            padding: 15px 40px;
            font-size: 1.3rem;
            font-weight: bold;
            background: rgba(0, 255, 0, 0.3);
            color: #00ff00;
            border: 3px solid #00ff00;
            border-radius: 10px;
            cursor: pointer;
        }

        .wrong-btn {
            padding: 15px 40px;
            font-size: 1.3rem;
            font-weight: bold;
            background: rgba(255, 0, 0, 0.3);
            color: #ff6666;
            border: 3px solid #ff6666;
            border-radius: 10px;
            cursor: pointer;
        }

        .bingo-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 5px solid #FFD700;
            border-radius: 20px;
            padding: 50px;
            z-index: 4000;
            display: none;
            text-align: center;
        }

        .bingo-alert.show {
            display: block;
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* Round 2 Modal */
        .round2-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .round2-modal.show {
            display: flex;
        }

        .round2-content {
            background: linear-gradient(135deg, #da251d 0%, #c41e1a 100%);
            border: 5px solid #FFD700;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .round2-question {
            font-size: 1.6rem;
            color: #FFD700;
            line-height: 1.8;
            margin-bottom: 30px;
            text-align: left;
        }

        .round2-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }

        .award-team-btn {
            flex: 1;
            padding: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .award-team-a {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            border: 3px solid #ff0000;
            color: #fff;
        }

        .award-team-b {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border: 3px solid #FFD700;
            color: #da251d;
        }

        .award-team-btn:hover {
            transform: scale(1.05);
        }

        /* Final Results */
        .final-results {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .final-results.show {
            display: flex;
        }

        .results-content {
            background: linear-gradient(135deg, #da251d 0%, #c41e1a 100%);
            border: 5px solid #FFD700;
            border-radius: 20px;
            padding: 50px;
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        .results-title {
            font-size: 3rem;
            color: #FFD700;
            margin-bottom: 40px;
            text-transform: uppercase;
        }

        .results-scores {
            display: flex;
            gap: 40px;
            justify-content: center;
            margin-bottom: 40px;
        }

        .result-team {
            flex: 1;
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #FFD700;
        }

        .result-team.winner {
            background: rgba(255, 215, 0, 0.3);
            border-width: 5px;
            transform: scale(1.1);
        }

        .result-team-name {
            font-size: 2rem;
            color: #FFD700;
            margin-bottom: 20px;
        }

        .result-team-score {
            font-size: 4rem;
            color: #FFD700;
            font-weight: bold;
        }

        .winner-badge {
            font-size: 3rem;
            margin-top: 20px;
        }

        .close-results-btn {
            padding: 15px 40px;
            font-size: 1.3rem;
            font-weight: bold;
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            border: 3px solid #FFD700;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
        }

        .close-results-btn:hover {
            background: rgba(255, 215, 0, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Role Selection Screen -->
        <div id="roleSelection" class="role-selection">
            <h1>
                <span class="star">‚òÖ</span>
                T∆Ø T∆Ø·ªûNG H·ªí CH√ç MINH
                <span class="star">‚òÖ</span>
            </h1>
            <button class="role-btn" onclick="selectRole('host')">
                üñ•Ô∏è Join as HOST (Projector)
            </button>
            <button class="role-btn" onclick="selectRole('teamA')">
                üî¥ Join as TEAM A
            </button>
            <button class="role-btn" onclick="selectRole('teamB')">
                üîµ Join as TEAM B
            </button>
        </div>

        <!-- Host Screen -->
        <div id="hostScreen" class="game-screen">
            <h1>
                <span class="star">‚òÖ</span>
                HOST CONTROL PANEL
                <span class="star">‚òÖ</span>
            </h1>
            
            <div class="scoreboard">
                <div class="team-score">
                    <h2>üî¥ TEAM A</h2>
                    <div class="score" id="scoreA">0</div>
                    <div class="score-controls">
                        <button class="score-btn" onclick="adjustScore('A', 10)">+10</button>
                        <button class="score-btn" onclick="adjustScore('A', -10)">-10</button>
                    </div>
                </div>
                <div class="team-score">
                    <h2>üîµ TEAM B</h2>
                    <div class="score" id="scoreB">0</div>
                    <div class="score-controls">
                        <button class="score-btn" onclick="adjustScore('B', 10)">+10</button>
                        <button class="score-btn" onclick="adjustScore('B', -10)">-10</button>
                    </div>
                </div>
            </div>

            <div class="question-grid">
                <div class="question-cell" data-question="1">Q1</div>
                <div class="question-cell" data-question="2">Q2</div>
                <div class="question-cell" data-question="3">Q3</div>
                <div class="question-cell" data-question="4">Q4</div>
                <div class="question-cell" data-question="5">Q5</div>
                <div class="question-cell" data-question="6">Q6</div>
                <div class="question-cell" data-question="7">Q7</div>
                <div class="question-cell" data-question="8">Q8</div>
                <div class="question-cell" data-question="9">Q9</div>
            </div>

            <div class="host-controls">
                <button class="control-btn" onclick="resetBuzzer()">üîî Reset Buzzer</button>
                <button class="control-btn" onclick="showRound2()">üéØ V√íNG 2 - C√¢u h·ªèi m·ªü</button>
                <button class="control-btn" onclick="showFinalResults()">üèÜ K·∫øt qu·∫£ chung cu·ªôc</button>
                <button class="control-btn danger" onclick="resetGame()">üîÑ Reset Game</button>
                <button class="control-btn" onclick="backToMain()">üè† Quay l·∫°i m√†n h√¨nh ch√≠nh</button>
            </div>
        </div>

        <!-- Team A Screen -->
        <div id="teamAScreen" class="game-screen">
            <h1>
                <span class="star">‚òÖ</span>
                TEAM A (ƒê·ªé)
                <span class="star">‚òÖ</span>
            </h1>
            <div class="scoreboard" style="margin-bottom: 20px;">
                <div class="team-score">
                    <h2>ƒêi·ªÉm c·ªßa b·∫°n</h2>
                    <div class="score" id="teamAScore">0</div>
                </div>
            </div>
            <h2 style="text-align: center; margin-bottom: 20px; color: #FFD700;">Ch·ªçn √¥ c√¢u h·ªèi</h2>
            <div class="team-grid">
                <div class="question-cell" data-cell="1" onclick="teamSelectCell('A', 1)">1</div>
                <div class="question-cell" data-cell="2" onclick="teamSelectCell('A', 2)">2</div>
                <div class="question-cell" data-cell="3" onclick="teamSelectCell('A', 3)">3</div>
                <div class="question-cell" data-cell="4" onclick="teamSelectCell('A', 4)">4</div>
                <div class="question-cell" data-cell="5" onclick="teamSelectCell('A', 5)">5</div>
                <div class="question-cell" data-cell="6" onclick="teamSelectCell('A', 6)">6</div>
                <div class="question-cell" data-cell="7" onclick="teamSelectCell('A', 7)">7</div>
                <div class="question-cell" data-cell="8" onclick="teamSelectCell('A', 8)">8</div>
                <div class="question-cell" data-cell="9" onclick="teamSelectCell('A', 9)">9</div>
            </div>
            <div class="buzzer-status" id="statusA" style="text-align: center; margin-top: 20px;"></div>
            <div style="text-align: center;">
                <button class="back-btn" onclick="backToMain()" style="margin-top: 20px;">üè† Quay l·∫°i m√†n h√¨nh ch√≠nh</button>
            </div>
        </div>

        <!-- Team B Screen -->
        <div id="teamBScreen" class="game-screen">
            <h1>
                <span class="star">‚òÖ</span>
                TEAM B (V√ÄNG)
                <span class="star">‚òÖ</span>
            </h1>
            <div class="scoreboard" style="margin-bottom: 20px;">
                <div class="team-score">
                    <h2>ƒêi·ªÉm c·ªßa b·∫°n</h2>
                    <div class="score" id="teamBScore">0</div>
                </div>
            </div>
            <h2 style="text-align: center; margin-bottom: 20px; color: #FFD700;">Ch·ªçn √¥ c√¢u h·ªèi</h2>
            <div class="team-grid">
                <div class="question-cell" data-cell="1" onclick="teamSelectCell('B', 1)">1</div>
                <div class="question-cell" data-cell="2" onclick="teamSelectCell('B', 2)">2</div>
                <div class="question-cell" data-cell="3" onclick="teamSelectCell('B', 3)">3</div>
                <div class="question-cell" data-cell="4" onclick="teamSelectCell('B', 4)">4</div>
                <div class="question-cell" data-cell="5" onclick="teamSelectCell('B', 5)">5</div>
                <div class="question-cell" data-cell="6" onclick="teamSelectCell('B', 6)">6</div>
                <div class="question-cell" data-cell="7" onclick="teamSelectCell('B', 7)">7</div>
                <div class="question-cell" data-cell="8" onclick="teamSelectCell('B', 8)">8</div>
                <div class="question-cell" data-cell="9" onclick="teamSelectCell('B', 9)">9</div>
            </div>
            <div class="buzzer-status" id="statusB" style="text-align: center; margin-top: 20px;"></div>
            <div style="text-align: center;">
                <button class="back-btn" onclick="backToMain()" style="margin-top: 20px;">üè† Quay l·∫°i m√†n h√¨nh ch√≠nh</button>
            </div>
        </div>

        <!-- Buzzer Alert (Host) -->
        <div id="buzzerAlert" class="buzzer-alert">
            <h2 id="buzzerTeamName"></h2>
            <p style="font-size: 1.5rem; margin-top: 20px;">RANG THE BELL!</p>
        </div>
    </div>

    <!-- Approval Notification (Host Only) -->
    <div id="approvalNotification" class="approval-notification">
        <h3 style="color: #FFD700; margin-bottom: 10px;" id="approvalText"></h3>
        <div class="approval-actions">
            <button class="approve-btn" onclick="approveSelection()">‚úì PH√ä DUY·ªÜT</button>
            <button class="reject-btn" onclick="rejectSelection()">‚úó T·ª™ CH·ªêI</button>
        </div>
    </div>

    <!-- Bingo Alert -->
    <div id="bingoAlert" class="bingo-alert">
        <h1 style="color: #FFD700; font-size: 4rem; margin-bottom: 20px;">üéâ BINGO! üéâ</h1>
        <h2 style="color: #FFD700; font-size: 2rem;" id="bingoTeam"></h2>
        <p style="color: #FFD700; font-size: 1.5rem; margin-top: 20px;">+50 ƒêI·ªÇM TH∆Ø·ªûNG!</p>
    </div>

    <!-- Final Results Modal -->
    <div id="finalResults" class="final-results">
        <div class="results-content">
            <div class="results-title">üèÜ K·∫æT QU·∫¢ CHUNG CU·ªòC üèÜ</div>
            <div class="results-scores">
                <div class="result-team" id="resultTeamA">
                    <div class="result-team-name">üî¥ TEAM A</div>
                    <div class="result-team-score" id="finalScoreA">0</div>
                    <div class="winner-badge" id="winnerBadgeA"></div>
                </div>
                <div class="result-team" id="resultTeamB">
                    <div class="result-team-name">üü° TEAM B</div>
                    <div class="result-team-score" id="finalScoreB">0</div>
                    <div class="winner-badge" id="winnerBadgeB"></div>
                </div>
            </div>
            <button class="close-results-btn" onclick="closeFinalResults()">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getDatabase, ref, set, onValue, update, get } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';

        // Host Password
        const HOST_PASSWORD = 'T@ohan123';

        // Questions Database (Chapter 6)
        const questions = [
            {
                id: 1,
                question: "V√†o th√°ng 8/1943, khi c√≤n trong nh√† t√π c·ªßa T∆∞·ªüng Gi·ªõi Th·∫°ch, H·ªì Ch√≠ Minh ƒë√£ ƒë∆∞a ra quan ni·ªám v·ªÅ lƒ©nh v·ª±c n√†o sau ƒë√¢y?",
                answers: ["A. Kinh t·∫ø", "B. Ch√≠nh tr·ªã", "C. VƒÉn h√≥a", "D. Ngo·∫°i giao"],
                correct: "C"
            },
            {
                id: 2,
                question: "Theo H·ªì Ch√≠ Minh, m·ªëi quan h·ªá gi·ªØa vƒÉn h√≥a v·ªõi kinh t·∫ø v√† ch√≠nh tr·ªã ƒë∆∞·ª£c x√°c ƒë·ªãnh nh∆∞ th·∫ø n√†o?",
                answers: ["A. VƒÉn h√≥a n·∫±m ngo√†i kinh t·∫ø v√† ch√≠nh tr·ªã", "B. VƒÉn h√≥a ·ªü trong kinh t·∫ø v√† ch√≠nh tr·ªã", "C. VƒÉn h√≥a ƒë·ª©ng tr√™n kinh t·∫ø v√† ch√≠nh tr·ªã", "D. VƒÉn h√≥a kh√¥ng li√™n quan ƒë·∫øn kinh t·∫ø"],
                correct: "B"
            },
            {
                id: 3,
                question: 'Trong quan ƒëi·ªÉm c·ªßa H·ªì Ch√≠ Minh v·ªÅ vai tr√≤ c·ªßa vƒÉn h√≥a, Ng∆∞·ªùi ƒë√£ kh·∫≥ng ƒë·ªãnh: "VƒÉn h√≥a ngh·ªá thu·∫≠t c≈©ng l√† m·ªôt..."?',
                answers: ["A. Tr√≤ ch∆°i gi·∫£i tr√≠", "B. C√¥ng c·ª• tuy√™n truy·ªÅn", "C. M·∫∑t tr·∫≠n", "D. H√¨nh th·ª©c kinh doanh"],
                correct: "C"
            },
            {
                id: 4,
                question: "H·ªì Ch√≠ Minh v√≠ ƒë·∫°o ƒë·ª©c c√°ch m·∫°ng nh∆∞ y·∫øu t·ªë n√†o c·ªßa c√¢y v√† s√¥ng?",
                answers: ["A. C√†nh v√† nh√°nh", "B. Hoa v√† l√°", "C. G·ªëc v√† ngu·ªìn", "D. Th√¢n v√† d√≤ng ch·∫£y"],
                correct: "C"
            },
            {
                id: 5,
                question: "Trong c√°c ph·∫©m ch·∫•t ƒë·∫°o ƒë·ª©c c√°ch m·∫°ng, ph·∫©m ch·∫•t n√†o ƒë∆∞·ª£c H·ªì Ch√≠ Minh coi l√† quan tr·ªçng nh·∫•t, bao tr√πm nh·∫•t?",
                answers: ["A. C·∫ßn, ki·ªám, li√™m, ch√≠nh", "B. Trung v·ªõi n∆∞·ªõc, hi·∫øu v·ªõi d√¢n", "C. Y√™u th∆∞∆°ng con ng∆∞·ªùi", "D. Tinh th·∫ßn qu·ªëc t·∫ø trong s√°ng"],
                correct: "B"
            },
            {
                id: 6,
                question: 'Theo H·ªì Ch√≠ Minh, ch·ªØ "Li√™m" trong "C·∫ßn, ki·ªám, li√™m, ch√≠nh" c√≥ nghƒ©a l√† g√¨?',
                answers: ["A. Si√™ng nƒÉng, chƒÉm ch·ªâ", "B. Ti·∫øt ki·ªám, kh√¥ng hoang ph√≠", "C. Trong s·∫°ch, kh√¥ng tham lam", "D. Th·∫≥ng th·∫Øn, ƒë·ª©ng ƒë·∫Øn"],
                correct: "C"
            },
            {
                id: 7,
                question: '"M·ªôt t·∫•m g∆∞∆°ng s·ªëng c√≤n c√≥ gi√° tr·ªã h∆°n m·ªôt trƒÉm b√†i di·ªÖn vƒÉn tuy√™n truy·ªÅn" th·ªÉ hi·ªán nguy√™n t·∫Øc x√¢y d·ª±ng ƒë·∫°o ƒë·ª©c n√†o c·ªßa H·ªì Ch√≠ Minh?',
                answers: ["A. N√≥i ƒëi ƒë√¥i v·ªõi l√†m, n√™u g∆∞∆°ng v·ªÅ ƒë·∫°o ƒë·ª©c", "B. X√¢y ƒëi ƒë√¥i v·ªõi ch·ªëng", "C. Tu d∆∞·ª°ng ƒë·∫°o ƒë·ª©c su·ªët ƒë·ªùi", "D. Ph√™ b√¨nh v√† t·ª± ph√™ b√¨nh"],
                correct: "A"
            },
            {
                id: 8,
                question: 'ƒêi·ªÅn v√†o ch·ªó tr·ªëng c√¢u n√≥i n·ªïi ti·∫øng c·ªßa B√°c: "V√¨ l·ª£i √≠ch m∆∞·ªùi nƒÉm th√¨ ph·∫£i tr·ªìng c√¢y, v√¨ l·ª£i √≠ch trƒÉm nƒÉm th√¨ ph·∫£i ..."?',
                answers: ["A. Tr·ªìng ng∆∞·ªùi", "B. X√¢y tr∆∞·ªùng h·ªçc", "C. Ph√°t tri·ªÉn kinh t·∫ø", "D. Gi·ªØ n∆∞·ªõc"],
                correct: "A"
            },
            {
                id: 9,
                question: "H·ªì Ch√≠ Minh x√°c ƒë·ªãnh con ng∆∞·ªùi v·ª´a l√† m·ª•c ti√™u, v·ª´a l√† ... c·ªßa c√°ch m·∫°ng?",
                answers: ["A. C√¥ng c·ª•", "B. ƒê·ªông l·ª±c", "C. Kh√°ch th·ªÉ", "D. K·∫øt qu·∫£"],
                correct: "B"
            }
        ];

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBVnhRlz7goa18Y0Uwb6E3yJuTEBvxWEgY",
            authDomain: "tu-tuong-hcm-game.firebaseapp.com",
            databaseURL: "https://tu-tuong-hcm-game-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "tu-tuong-hcm-game",
            storageBucket: "tu-tuong-hcm-game.firebasestorage.app",
            messagingSenderId: "637672671853",
            appId: "1:637672671853:web:b6396983c7878376b1cd64",
            measurementId: "G-WLRF1W52DH"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Global Variables
        let currentRole = null;
        let buzzerSound = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBCx+zPDZgjMGHm7A7+OZRQ0RVa7n7qdWEwxDmN3xu2oiBDKJ0fDZeCwHKHnI8NyMPAkTW7Pq7qpYFApHouDwwG0jBjCFzfDZfC8GKHrK8d2OPwkTV7Ho7alZFQ1FoeDvvmwiBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlYEwxDmt3wvGsiBDKGzfDZey8HKnrJ8d2OPgkUVrDn7KlZFQ1FoeDvvmwjBDGIzvDYei8HKXrJ8dyOPgkUVrDn7KlYEwxDmt3wvGwiBDKGzfDZey8HKnrJ8d2OPgkUVrDn7KlZFQ1FoeDvvmwjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvvmwjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlYEwxDmt3wvGwiBDKGzfDZey8HKnrJ8d2OPgkUVrDn7KlZFQ1FoeDvvmwjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvvmwjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvvmwjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvvmwjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7KlZFQ1FoeDvv2wjBDGHzvDYei8HKXrJ8dyOPgkUVrDn7A==');

        // Initialize Database
        async function initializeDatabase() {
            const gameStateRef = ref(database, 'gameState');
            const buzzerRef = ref(database, 'buzzer');
            const cellsRef = ref(database, 'cells');
            const cellSelectionRef = ref(database, 'cellSelection');
            
            const gameStateSnapshot = await get(gameStateRef);
            if (!gameStateSnapshot.exists()) {
                await set(gameStateRef, {
                    currentRound: 1,
                    scores: {
                        A: 0,
                        B: 0
                    }
                });
            }

            const buzzerSnapshot = await get(buzzerRef);
            if (!buzzerSnapshot.exists()) {
                await set(buzzerRef, {
                    active: null,
                    timestamp: null
                });
            }

            const cellsSnapshot = await get(cellsRef);
            if (!cellsSnapshot.exists()) {
                const initialCells = {};
                for (let i = 1; i <= 9; i++) {
                    initialCells[i] = { owner: null, answered: false };
                }
                await set(cellsRef, initialCells);
            }

            const cellSelectionSnapshot = await get(cellSelectionRef);
            if (!cellSelectionSnapshot.exists()) {
                await set(cellSelectionRef, {
                    teamRequesting: null,
                    cellNumber: null,
                    status: null,
                    currentQuestion: null,
                    answeringTeam: null
                });
            }
        }

        // Role Selection
        window.selectRole = function(role) {
            if (role === 'host') {
                const password = prompt('Nh·∫≠p m·∫≠t kh·∫©u HOST:');
                if (password !== HOST_PASSWORD) {
                    alert('‚ùå M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!');
                    return;
                }
            }
            
            currentRole = role;
            document.getElementById('roleSelection').style.display = 'none';
            
            if (role === 'host') {
                document.getElementById('hostScreen').classList.add('active');
                initHostScreen();
            } else if (role === 'teamA') {
                document.getElementById('teamAScreen').classList.add('active');
                initTeamScreen('A');
            } else if (role === 'teamB') {
                document.getElementById('teamBScreen').classList.add('active');
                initTeamScreen('B');
            }
        };

        // Back to Main Screen
        window.backToMain = function() {
            document.getElementById('roleSelection').style.display = 'flex';
            document.getElementById('hostScreen').classList.remove('active');
            document.getElementById('teamAScreen').classList.remove('active');
            document.getElementById('teamBScreen').classList.remove('active');
            document.getElementById('questionModal').classList.remove('show');
            document.getElementById('round2Modal').classList.remove('show');
            document.getElementById('finalResults').classList.remove('show');
            currentRole = null;
        };

        // Initialize Host Screen
        function initHostScreen() {
            // Listen to game state
            const gameStateRef = ref(database, 'gameState');
            onValue(gameStateRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('scoreA').textContent = data.scores.A;
                    document.getElementById('scoreB').textContent = data.scores.B;
                }
            });

            // Listen to cells state
            const cellsRef = ref(database, 'cells');
            onValue(cellsRef, (snapshot) => {
                const cells = snapshot.val();
                if (cells) {
                    updateHostGrid(cells);
                }
            });

            // Listen to cell selection requests
            const cellSelectionRef = ref(database, 'cellSelection');
            onValue(cellSelectionRef, (snapshot) => {
                const selection = snapshot.val();
                if (selection && selection.status === 'pending') {
                    showApprovalNotification(selection);
                } else {
                    hideApprovalNotification();
                }
            });
        }

        // Initialize Team Screen
        function initTeamScreen(team) {
            const statusId = team === 'A' ? 'statusA' : 'statusB';
            const scoreId = team === 'A' ? 'teamAScore' : 'teamBScore';

            // Listen to game state for scores
            const gameStateRef = ref(database, 'gameState');
            onValue(gameStateRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById(scoreId).textContent = data.scores[team];
                }
            });

            // Listen to cells state
            const cellsRef = ref(database, 'cells');
            onValue(cellsRef, (snapshot) => {
                const cells = snapshot.val();
                if (cells) {
                    updateTeamGrid(cells, team);
                }
            });

            // Listen to cell selection status
            const cellSelectionRef = ref(database, 'cellSelection');
            onValue(cellSelectionRef, (snapshot) => {
                const selection = snapshot.val();
                const status = document.getElementById(statusId);
                
                if (selection && selection.teamRequesting === `Team ${team}`) {
                    if (selection.status === 'pending') {
                        status.textContent = `‚è≥ ƒêang ch·ªù Host ph√™ duy·ªát √¥ ${selection.cellNumber}...`;
                        status.style.color = '#FFD700';
                    } else if (selection.status === 'approved') {
                        status.textContent = `‚úÖ ƒê√£ ƒë∆∞·ª£c duy·ªát! H√£y tr·∫£ l·ªùi c√¢u h·ªèi!`;
                        status.style.color = '#00ff00';
                    } else if (selection.status === 'rejected') {
                        status.textContent = `‚ùå B·ªã t·ª´ ch·ªëi. Ch·ªçn √¥ kh√°c!`;
                        status.style.color = '#ff6666';
                    }
                } else {
                    status.textContent = 'Ch·ªçn m·ªôt √¥ ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi';
                    status.style.color = '#FFD700';
                }
            });
        }

        // Team Select Cell
        window.teamSelectCell = async function(team, cellNumber) {
            const cellsRef = ref(database, 'cells');
            const cellSelectionRef = ref(database, 'cellSelection');
            
            try {
                // Check if cell is already answered
                const cellsSnapshot = await get(cellsRef);
                const cells = cellsSnapshot.val();
                
                if (cells[cellNumber].answered) {
                    alert('√î n√†y ƒë√£ ƒë∆∞·ª£c tr·∫£ l·ªùi!');
                    return;
                }
                
                // Check if there's a pending selection
                const selectionSnapshot = await get(cellSelectionRef);
                const currentSelection = selectionSnapshot.val();
                
                if (currentSelection && currentSelection.status === 'pending') {
                    alert('Vui l√≤ng ch·ªù Host ph√™ duy·ªát y√™u c·∫ßu hi·ªán t·∫°i!');
                    return;
                }
                
                // Submit selection request
                await set(cellSelectionRef, {
                    teamRequesting: `Team ${team}`,
                    cellNumber: cellNumber,
                    status: 'pending',
                    currentQuestion: null,
                    answeringTeam: `Team ${team}`,
                    timestamp: Date.now()
                });
            } catch (error) {
                console.error('Error selecting cell:', error);
            }
        };

        // Show Approval Notification
        function showApprovalNotification(selection) {
            const notification = document.getElementById('approvalNotification');
            const text = document.getElementById('approvalText');
            text.textContent = `${selection.teamRequesting} mu·ªën ch·ªçn √¥ ${selection.cellNumber}`;
            notification.classList.add('show');
        }

        // Hide Approval Notification
        function hideApprovalNotification() {
            const notification = document.getElementById('approvalNotification');
            notification.classList.remove('show');
        }

        // Approve Selection
        window.approveSelection = async function() {
            const cellSelectionRef = ref(database, 'cellSelection');
            const snapshot = await get(cellSelectionRef);
            const selection = snapshot.val();
            
            if (selection) {
                await update(cellSelectionRef, {
                    status: 'approved'
                });
                
                // Show question to host
                showQuestionToHost(selection.cellNumber, selection.answeringTeam);
            }
        };

        // Reject Selection
        window.rejectSelection = async function() {
            const cellSelectionRef = ref(database, 'cellSelection');
            await update(cellSelectionRef, {
                status: 'rejected'
            });
            
            // Clear after 2 seconds
            setTimeout(async () => {
                await set(cellSelectionRef, {
                    teamRequesting: null,
                    cellNumber: null,
                    status: null,
                    currentQuestion: null,
                    answeringTeam: null
                });
            }, 2000);
        };

        // Reset Buzzer
        window.resetBuzzer = async function() {
            const buzzerRef = ref(database, 'buzzer');
            await set(buzzerRef, {
                active: null,
                timestamp: null
            });
        };

        // Show Buzzer Alert
        function showBuzzerAlert(teamName) {
            const alert = document.getElementById('buzzerAlert');
            const teamNameEl = document.getElementById('buzzerTeamName');
            teamNameEl.textContent = teamName;
            alert.classList.add('show');
            playBuzzerSound();
        }

        // Hide Buzzer Alert
        function hideBuzzerAlert() {
            const alert = document.getElementById('buzzerAlert');
            alert.classList.remove('show');
        }

        // Play Buzzer Sound
        function playBuzzerSound() {
            try {
                buzzerSound.play();
            } catch (error) {
                console.log('Audio playback failed:', error);
            }
        }

        // Adjust Score
        window.adjustScore = async function(team, points) {
            const gameStateRef = ref(database, 'gameState');
            const snapshot = await get(gameStateRef);
            const currentState = snapshot.val();
            
            const newScore = Math.max(0, currentState.scores[team] + points);
            
            await update(gameStateRef, {
                [`scores/${team}`]: newScore
            });
        };

        // Reset Game
        window.resetGame = async function() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën reset to√†n b·ªô tr√≤ ch∆°i?')) {
                const gameStateRef = ref(database, 'gameState');
                const buzzerRef = ref(database, 'buzzer');
                const cellsRef = ref(database, 'cells');
                const cellSelectionRef = ref(database, 'cellSelection');
                
                await set(gameStateRef, {
                    currentRound: 1,
                    scores: {
                        A: 0,
                        B: 0
                    }
                });
                
                await set(buzzerRef, {
                    active: null,
                    timestamp: null
                });
                
                const initialCells = {};
                for (let i = 1; i <= 9; i++) {
                    initialCells[i] = { owner: null, answered: false };
                }
                await set(cellsRef, initialCells);
                
                await set(cellSelectionRef, {
                    teamRequesting: null,
                    cellNumber: null,
                    status: null,
                    currentQuestion: null,
                    answeringTeam: null
                });
                
                document.getElementById('questionModal').classList.remove('show');
                document.getElementById('round2Modal').classList.remove('show');
                document.getElementById('finalResults').classList.remove('show');
            }
        };

        // Show Question to Host
        let questionTimer = null;
        let timeLeft = 30;
        
        function showQuestionToHost(cellNumber, answeringTeam) {
            const question = questions[cellNumber - 1];
            if (!question) return;

            document.getElementById('questionHeader').textContent = `C√¢u h·ªèi #${cellNumber} - ${answeringTeam}`;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('answerOptions');
            optionsContainer.innerHTML = '';
            
            question.answers.forEach(answer => {
                const div = document.createElement('div');
                div.className = 'answer-btn';
                div.textContent = answer;
                if (answer.startsWith(question.correct)) {
                    div.style.borderColor = '#00ff00';
                    div.style.color = '#00ff00';
                }
                optionsContainer.appendChild(div);
            });
            
            // Show timer
            timeLeft = 30;
            const timerDisplay = document.getElementById('timerDisplay');
            timerDisplay.textContent = `‚è±Ô∏è ${timeLeft}s`;
            timerDisplay.classList.remove('warning');
            
            if (questionTimer) clearInterval(questionTimer);
            questionTimer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `‚è±Ô∏è ${timeLeft}s`;
                if (timeLeft <= 10) {
                    timerDisplay.classList.add('warning');
                }
                if (timeLeft <= 0) {
                    clearInterval(questionTimer);
                }
            }, 1000);
            
            document.getElementById('questionModal').classList.add('show');
        }

        // Mark Answer (Host controls)
        window.markAnswer = async function(isCorrect) {
            if (questionTimer) clearInterval(questionTimer);
            
            const cellSelectionRef = ref(database, 'cellSelection');
            const cellsRef = ref(database, 'cells');
            const gameStateRef = ref(database, 'gameState');
            
            const selectionSnapshot = await get(cellSelectionRef);
            const selection = selectionSnapshot.val();
            
            if (!selection) return;
            
            const cellNumber = selection.cellNumber;
            const answeringTeam = selection.answeringTeam;
            const teamLetter = answeringTeam === 'Team A' ? 'A' : 'B';
            const otherTeam = teamLetter === 'A' ? 'B' : 'A';
            
            if (isCorrect) {
                // Correct answer: assign cell to team and add 10 points
                await update(ref(database, `cells/${cellNumber}`), {
                    owner: teamLetter,
                    answered: true
                });
                
                const gameStateSnapshot = await get(gameStateRef);
                const gameState = gameStateSnapshot.val();
                const newScore = gameState.scores[teamLetter] + 10;
                
                await update(gameStateRef, {
                    [`scores/${teamLetter}`]: newScore
                });
                
                // Check for bingo
                setTimeout(() => checkBingo(teamLetter), 500);
                
                // Clear selection
                await set(cellSelectionRef, {
                    teamRequesting: null,
                    cellNumber: null,
                    status: null,
                    currentQuestion: null,
                    answeringTeam: null
                });
                
                document.getElementById('questionModal').classList.remove('show');
            } else {
                // Wrong answer: allow other team to steal
                const shouldSteal = confirm(`${answeringTeam} tr·∫£ l·ªùi sai! Cho Team ${otherTeam} c∆° h·ªôi c∆∞·ªõp √¥?`);
                
                if (shouldSteal) {
                    await update(cellSelectionRef, {
                        answeringTeam: `Team ${otherTeam}`
                    });
                    
                    document.getElementById('questionHeader').textContent += ` ‚Üí Team ${otherTeam} (C∆∞·ªõp √¥!)`;
                    timeLeft = 30;
                    const timerDisplay = document.getElementById('timerDisplay');
                    timerDisplay.textContent = `‚è±Ô∏è ${timeLeft}s`;
                    timerDisplay.classList.remove('warning');
                    
                    if (questionTimer) clearInterval(questionTimer);
                    questionTimer = setInterval(() => {
                        timeLeft--;
                        timerDisplay.textContent = `‚è±Ô∏è ${timeLeft}s`;
                        if (timeLeft <= 10) {
                            timerDisplay.classList.add('warning');
                        }
                        if (timeLeft <= 0) {
                            clearInterval(questionTimer);
                        }
                    }, 1000);
                } else {
                    // Both teams wrong: mark as dead
                    await update(ref(database, `cells/${cellNumber}`), {
                        owner: 'dead',
                        answered: true
                    });
                    
                    await set(cellSelectionRef, {
                        teamRequesting: null,
                        cellNumber: null,
                        status: null,
                        currentQuestion: null,
                        answeringTeam: null
                    });
                    
                    document.getElementById('questionModal').classList.remove('show');
                }
            }
        };

        // Check Bingo
        async function checkBingo(team) {
            const cellsRef = ref(database, 'cells');
            const snapshot = await get(cellsRef);
            const cells = snapshot.val();
            
            const grid = [
                [cells[1].owner, cells[2].owner, cells[3].owner],
                [cells[4].owner, cells[5].owner, cells[6].owner],
                [cells[7].owner, cells[8].owner, cells[9].owner]
            ];
            
            let hasBingo = false;
            
            // Check rows
            for (let i = 0; i < 3; i++) {
                if (grid[i][0] === team && grid[i][1] === team && grid[i][2] === team) {
                    hasBingo = true;
                }
            }
            
            // Check columns
            for (let i = 0; i < 3; i++) {
                if (grid[0][i] === team && grid[1][i] === team && grid[2][i] === team) {
                    hasBingo = true;
                }
            }
            
            // Check diagonals
            if (grid[0][0] === team && grid[1][1] === team && grid[2][2] === team) {
                hasBingo = true;
            }
            if (grid[0][2] === team && grid[1][1] === team && grid[2][0] === team) {
                hasBingo = true;
            }
            
            if (hasBingo) {
                // Add 50 bonus points
                const gameStateRef = ref(database, 'gameState');
                const gameStateSnapshot = await get(gameStateRef);
                const gameState = gameStateSnapshot.val();
                const newScore = gameState.scores[team] + 50;
                
                await update(gameStateRef, {
                    [`scores/${team}`]: newScore
                });
                
                // Show bingo alert
                showBingoAlert(team);
            }
        }

        // Show Bingo Alert
        function showBingoAlert(team) {
            const alert = document.getElementById('bingoAlert');
            const teamText = document.getElementById('bingoTeam');
            teamText.textContent = `TEAM ${team} HO√ÄN TH√ÄNH 3 √î LI√äN TI·∫æP!`;
            alert.classList.add('show');
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // Show Round 2
        window.showRound2 = function() {
            document.getElementById('round2Modal').classList.add('show');
        };

        // Close Round 2
        window.closeRound2 = function() {
            document.getElementById('round2Modal').classList.remove('show');
        };

        // Award Round 2 Points
        window.awardRound2Points = async function(team) {
            const gameStateRef = ref(database, 'gameState');
            const snapshot = await get(gameStateRef);
            const gameState = snapshot.val();
            
            const newScore = gameState.scores[team] + 30;
            
            await update(gameStateRef, {
                [`scores/${team}`]: newScore
            });
            
            alert(`‚úÖ Team ${team} ƒë∆∞·ª£c c·ªông 30 ƒëi·ªÉm!`);
            closeRound2();
        };

        // Show Final Results
        window.showFinalResults = async function() {
            const gameStateRef = ref(database, 'gameState');
            const snapshot = await get(gameStateRef);
            const gameState = snapshot.val();
            
            const scoreA = gameState.scores.A;
            const scoreB = gameState.scores.B;
            
            document.getElementById('finalScoreA').textContent = scoreA;
            document.getElementById('finalScoreB').textContent = scoreB;
            
            const teamADiv = document.getElementById('resultTeamA');
            const teamBDiv = document.getElementById('resultTeamB');
            const badgeA = document.getElementById('winnerBadgeA');
            const badgeB = document.getElementById('winnerBadgeB');
            
            // Clear previous winner styling
            teamADiv.classList.remove('winner');
            teamBDiv.classList.remove('winner');
            badgeA.textContent = '';
            badgeB.textContent = '';
            
            // Determine winner
            if (scoreA > scoreB) {
                teamADiv.classList.add('winner');
                badgeA.textContent = 'üëë CHI·∫æN TH·∫ÆNG!';
            } else if (scoreB > scoreA) {
                teamBDiv.classList.add('winner');
                badgeB.textContent = 'üëë CHI·∫æN TH·∫ÆNG!';
            } else {
                badgeA.textContent = 'ü§ù H√íA!';
                badgeB.textContent = 'ü§ù H√íA!';
            }
            
            document.getElementById('finalResults').classList.add('show');
        };

        // Close Final Results
        window.closeFinalResults = function() {
            document.getElementById('finalResults').classList.remove('show');
        };

        // Update Host Grid
        function updateHostGrid(cells) {
            const cellElements = document.querySelectorAll('#hostScreen .question-cell');
            cellElements.forEach(cell => {
                const cellNum = parseInt(cell.dataset.question);
                const cellData = cells[cellNum];
                
                cell.classList.remove('team-a', 'team-b', 'dead');
                
                if (cellData.owner === 'A') {
                    cell.classList.add('team-a', 'answered');
                } else if (cellData.owner === 'B') {
                    cell.classList.add('team-b', 'answered');
                } else if (cellData.owner === 'dead') {
                    cell.classList.add('dead', 'answered');
                }
            });
        }

        // Update Team Grid
        function updateTeamGrid(cells, team) {
            const screenId = team === 'A' ? 'teamAScreen' : 'teamBScreen';
            const cellElements = document.querySelectorAll(`#${screenId} .question-cell`);
            
            cellElements.forEach(cell => {
                const cellNum = parseInt(cell.dataset.cell);
                const cellData = cells[cellNum];
                
                cell.classList.remove('team-a', 'team-b', 'dead', 'answered');
                
                if (cellData.owner === 'A') {
                    cell.classList.add('team-a', 'answered');
                } else if (cellData.owner === 'B') {
                    cell.classList.add('team-b', 'answered');
                } else if (cellData.owner === 'dead') {
                    cell.classList.add('dead', 'answered');
                }
            });
        }

        // Initialize the application
        initializeDatabase();
    </script>
</body>
</html>
